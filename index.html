<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CYBER SICH | OVERLORD EDITION</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono&display=swap');
        
        :root { --n: #00f2ff; --g: #fff200; --r: #ff0055; --bg: #020205; --card: rgba(10, 10, 20, 0.9); }
        
        body, html { margin: 0; padding: 0; background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; overflow: hidden; height: 100vh; }
        #c { display: block; width: 100vw; height: 100vh; position: absolute; z-index: 1; touch-action: none; }
        
        /* UI HUD */
        .ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; display: flex; flex-direction: column; }
        .interactive { pointer-events: auto; }

        .header { padding: 20px; display: flex; justify-content: space-between; align-items: flex-start; }
        .stats { background: var(--card); border-left: 4px solid var(--n); padding: 15px; backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-radius: 0 8px 8px 0; }
        .label { font-size: 10px; color: var(--n); letter-spacing: 2px; font-weight: 700; font-family: 'Space Mono'; }
        .val { font-size: 26px; font-weight: 900; color: #fff; margin-top: 5px; }

        /* Navigation Bar */
        .nav { margin-top: auto; background: rgba(0,0,0,0.8); border-top: 1px solid rgba(0,242,255,0.2); display: flex; padding: 10px; justify-content: space-around; backdrop-filter: blur(10px); }
        .nav-btn { color: #555; text-align: center; font-size: 9px; font-weight: 900; text-transform: uppercase; cursor: pointer; transition: 0.3s; padding: 10px; }
        .nav-btn.active { color: var(--n); text-shadow: 0 0 10px var(--n); }

        /* Modals & Menus */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .m { width: 90%; max-width: 400px; background: #05050a; border: 1px solid var(--n); padding: 25px; position: relative; box-shadow: 0 0 40px rgba(0,242,255,0.1); }
        .m-h { font-size: 18px; font-weight: 900; color: var(--n); margin-bottom: 15px; border-bottom: 1px solid #111; padding-bottom: 10px; }
        .m-b { font-size: 11px; line-height: 1.6; color: #888; margin-bottom: 20px; font-family: 'Space Mono'; }
        
        .grid-nft { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-height: 300px; overflow-y: auto; }
        .nft-slot { aspect-ratio: 1; background: #0a0a10; border: 1px dashed #222; display: flex; align-items: center; justify-content: center; font-size: 8px; color: #333; }
        
        .action-btn { background: var(--n); color: #000; border: none; padding: 15px; width: 100%; font-family: 'Orbitron'; font-weight: 900; text-transform: uppercase; cursor: pointer; letter-spacing: 1px; }
        .action-btn:active { transform: scale(0.98); background: #fff; }

        #ton-connect { zoom: 0.85; border: 1px solid rgba(0,242,255,0.2); border-radius: 8px; overflow: hidden; }
    </style>
</head>
<body>

<canvas id="c"></canvas>

<div class="ui">
    <div class="header">
        <div class="stats interactive">
            <div class="label">SICH_CORE_STABILITY</div>
            <div class="val" id="bal">0.00</div>
            <div style="font-size: 8px; color: #444; margin-top: 5px;">GEN_RATE: 0.005/SEC</div>
        </div>
        <div id="ton-connect" class="interactive"></div>
    </div>

    <div class="nav interactive">
        <div class="nav-btn active" onclick="goHome()">MAP_VIEW</div>
        <div class="nav-btn" onclick="openM('inventory')">ARMORY</div>
        <div class="nav-btn" onclick="openM('quests')">MISSIONS</div>
        <div class="nav-btn" onclick="openM('settings')">SYSTEM</div>
    </div>
</div>

<div id="ov" class="overlay interactive" onclick="closeM()">
    <div class="m" onclick="event.stopPropagation()">
        <div id="m-title" class="m-h">SYSTEM_MESSAGE</div>
        <div id="m-body" class="m-b">Initializing link...</div>
        <div id="m-extra"></div>
        <button class="action-btn" onclick="closeM()">CLOSE_TERMINAL</button>
    </div>
</div>

<script>
    /**
     * CYBER SICH ARCHITECTURE v5.0
     * Built for high-performance mobile WebApps
     */
     
    const APP = Telegram.WebApp;
    APP.expand();
    APP.enableClosingConfirmation();

    

    const CFG = {
        GRID: 100,
        N: "#00f2ff",
        G: "#fff200",
        R: "#ff0055",
        SICH_PER_SEC: 0.005
    };

    class SichEngine {
        constructor() {
            this.can = document.getElementById('c');
            this.ctx = this.can.getContext('2d');
            this.w = window.innerWidth;
            this.h = window.innerHeight;
            
            this.cam = { x: 0, y: 0, tx: 0, ty: 0, z: 1 };
            this.drag = { is: false, x: 0, y: 0 };
            
            this.user = { bal: 0, nfts: 0, multiplier: 1 };
            
            this.nodes = [
                { id: 'core', x: 0, y: 0, name: 'CENTRAL_REACTOR', size: 100, color: CFG.N, desc: 'Генератор енергії Січі. Стейкайте TON тут.' },
                { id: 'forge', x: -500, y: -300, name: 'NFT_FORGE', size: 70, color: CFG.G, desc: 'Тут куються Легендарні Козаки.' },
                { id: 'vault', x: 500, y: 300, name: 'LOTTO_VAULT', size: 70, color: CFG.R, desc: 'Протокол спалювання та розіграшів.' }
            ];

            this.dust = Array.from({length: 60}, () => ({
                x: Math.random() * 4000 - 2000,
                y: Math.random() * 4000 - 2000,
                s: Math.random() * 2 + 1,
                o: Math.random()
            }));

            this.init();
        }

        init() {
            this.resize();
            window.addEventListener('resize', () => this.resize());
            this.ctrls();
            this.loop();
        }

        resize() {
            this.w = window.innerWidth;
            this.h = window.innerHeight;
            this.can.width = this.w;
            this.can.height = this.h;
        }

        ctrls() {
            const s = (x, y) => { this.drag.is = true; this.drag.x = x; this.drag.y = y; };
            const m = (x, y) => {
                if (!this.drag.is) return;
                this.cam.tx += x - this.drag.x;
                this.cam.ty += y - this.drag.y;
                this.drag.x = x; this.drag.y = y;
            };
            const e = () => {
                if(this.drag.is) this.handleClick();
                this.drag.is = false;
            };

            this.can.addEventListener('mousedown', ev => s(ev.clientX, ev.clientY));
            window.addEventListener('mousemove', ev => m(ev.clientX, ev.clientY));
            window.addEventListener('mouseup', e);
            this.can.addEventListener('touchstart', ev => s(ev.touches[0].clientX, ev.touches[0].clientY));
            this.can.addEventListener('touchmove', ev => m(ev.touches[0].clientX, ev.touches[0].clientY));
            this.can.addEventListener('touchend', e);
        }

        handleClick() {
            this.nodes.forEach(n => {
                const nx = n.x + this.cam.x + this.w/2;
                const ny = n.y + this.cam.y + this.h/2;
                const d = Math.hypot(this.drag.x - nx, this.drag.y - ny);
                if(d < n.size + 20) {
                    this.triggerNode(n);
                }
            });
        }

        triggerNode(n) {
            APP.HapticFeedback.impactOccurred('medium');
            openM('node', n);
        }

        drawGrid() {
            this.ctx.strokeStyle = 'rgba(0, 242, 255, 0.05)';
            this.ctx.lineWidth = 1;
            const step = CFG.GRID;
            const ox = (this.cam.x * 0.3) % step;
            const oy = (this.cam.y * 0.3) % step;

            for(let x = ox; x < this.w; x += step) {
                this.ctx.beginPath(); this.ctx.moveTo(x, 0); this.ctx.lineTo(x, this.h); this.ctx.stroke();
            }
            for(let y = oy; y < this.h; y += step) {
                this.ctx.beginPath(); this.ctx.moveTo(0, y); this.ctx.lineTo(this.w, y); this.ctx.stroke();
            }
        }

        drawNode(n) {
            const x = n.x + this.cam.x + this.w/2;
            const y = n.y + this.cam.y + this.h/2;
            const time = Date.now() * 0.002;
            const pulse = 1 + Math.sin(time) * 0.05;

            this.ctx.save();
            this.ctx.translate(x, y);
            
            // Outer Aura
            const grad = this.ctx.createRadialGradient(0,0,0,0,0, n.size*2);
            grad.addColorStop(0, n.color + '22');
            grad.addColorStop(1, 'transparent');
            this.ctx.fillStyle = grad;
            this.ctx.beginPath(); this.ctx.arc(0,0, n.size*2 * pulse, 0, Math.PI*2); this.ctx.fill();

            // Geometric Core
            this.ctx.strokeStyle = n.color;
            this.ctx.lineWidth = 2;
            this.ctx.shadowBlur = 15;
            this.ctx.shadowColor = n.color;
            
            this.ctx.rotate(time * 0.2);
            for(let i=0; i<3; i++) {
                this.ctx.rotate(Math.PI/1.5);
                this.ctx.strokeRect(-n.size/2 * pulse, -n.size/2 * pulse, n.size * pulse, n.size * pulse);
            }
            
            this.ctx.restore();
            
            this.ctx.fillStyle = "#fff";
            this.ctx.font = "900 10px Orbitron";
            this.ctx.textAlign = "center";
            this.ctx.fillText(n.name, x, y + n.size + 40);
        }

        loop() {
            this.cam.x += (this.cam.tx - this.cam.x) * 0.1;
            this.cam.y += (this.cam.ty - this.cam.y) * 0.1;

            this.ctx.fillStyle = '#020205';
            this.ctx.fillRect(0, 0, this.w, this.h);

            this.drawGrid();

            // Particles
            this.ctx.fillStyle = "rgba(0, 242, 255, 0.2)";
            this.dust.forEach(p => {
                const px = (p.x + this.cam.x * 0.5 + 4000) % 4000 - 2000 + this.w/2;
                const py = (p.y + this.cam.y * 0.5 + 4000) % 4000 - 2000 + this.h/2;
                this.ctx.fillRect(px, py, p.s, p.s);
            });

            this.nodes.forEach(n => this.drawNode(n));

            this.user.bal += CFG.SICH_PER_SEC * this.user.multiplier;
            document.getElementById('bal').innerText = this.user.bal.toFixed(3);

            requestAnimationFrame(() => this.loop());
        }
    }

    // Modal Logic
    function openM(type, data = null) {
        const ov = document.getElementById('ov');
        const tit = document.getElementById('m-title');
        const bod = document.getElementById('m-body');
        const ext = document.getElementById('m-extra');
        ext.innerHTML = "";
        ov.style.display = 'flex';

        if(type === 'node') {
            tit.innerText = data.name;
            bod.innerText = data.desc;
            ext.innerHTML = `<button class="action-btn" onclick="nodeAction('${data.id}')">ВЗАЄМОДІЯ</button>`;
        } else if(type === 'inventory') {
            tit.innerText = "ARMORY_DATABASE";
            bod.innerText = "Твої бойові одиниці NFT. 50 Легендарних слотів доступно.";
            let g = '<div class="grid-nft">';
            for(let i=0; i<12; i++) g += '<div class="nft-slot">LOCKED</div>';
            ext.innerHTML = g + '</div>';
        }
    }

    function closeM() { document.getElementById('ov').style.display = 'none'; }
    function nodeAction(id) { 
        APP.HapticFeedback.notificationOccurred('success');
        APP.showAlert(`Протокол ${id} активовано. Систему оновлено.`);
        closeM();
    }

    // Start
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://cybersich.vercel.app/tonconnect-manifest.json',
        buttonRootId: 'ton-connect'
    });

    const Engine = new SichEngine();

</script>
</body>
</html>
