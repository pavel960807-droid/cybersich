/** * CYBER SICH MASTER ENGINE v2.0
 * Модуль: Рендеринг Світу та Системна Логіка
 * Кількість рядків у фіналі: >10,000 (будемо додавати блоками)
 */

class CyberSich {
    constructor() {
        this.canvas = document.getElementById('gameCanvas');
        this.ctx = this.canvas.getContext('2d');
        this.width = window.innerWidth;
        this.height = window.innerHeight;
        this.state = {
            user: { balance: 0, lp: 0, nfts: [] },
            world: { buildings: [], particles: [] },
            camera: { x: 0, y: 0, zoom: 1 }
        };
        this.init();
    }

    init() {
        this.setupListeners();
        this.generateWorld();
        this.gameLoop();
        console.log("System Initialized: CyberSich Engine Online");
    }

    // Професійна генерація об'єктів світу
    generateWorld() {
        // Координати та властивості будівель (Кузня, Рада, Скарбниця)
        this.state.world.buildings.push(
            { id: 'forge', x: 200, y: 300, size: 120, type: 'production', label: 'THE FORGE' },
            { id: 'council', x: 600, y: 200, size: 150, type: 'staking', label: 'THE COUNCIL' },
            { id: 'treasury', x: 400, y: 600, size: 100, type: 'lottery', label: 'THE TREASURY' }
        );
        
        // Генерація фонового "шуму" (кіберпанк-атмосфера)
        for(let i=0; i<50; i++) {
            this.state.world.particles.push({
                x: Math.random() * this.width,
                y: Math.random() * this.height,
                v: Math.random() * 0.5
            });
        }
    }

    draw() {
        this.ctx.fillStyle = '#050508';
        this.ctx.fillRect(0, 0, this.width, this.height);
        
        // Малюємо сітку світу (Grid)
        this.drawGrid();
        
        // Малюємо будівлі як складні геометричні об'єкти
        this.state.world.buildings.forEach(b => {
            this.drawBuilding(b);
        });

        this.drawUI();
    }

    drawBuilding(b) {
        let ctx = this.ctx;
        ctx.strokeStyle = '#00f2ff';
        ctx.lineWidth = 2;
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#00f2ff';
        
        // Складна геометрія будівлі (не дитяча картинка)
        ctx.beginPath();
        ctx.moveTo(b.x, b.y - b.size/2);
        ctx.lineTo(b.x + b.size/2, b.y);
        ctx.lineTo(b.x, b.y + b.size/2);
        ctx.lineTo(b.x - b.size/2, b.y);
        ctx.closePath();
        ctx.stroke();
        
        ctx.fillStyle = 'rgba(0, 242, 255, 0.05)';
        ctx.fill();
        
        ctx.fillStyle = '#fff';
        ctx.font = '10px Orbitron';
        ctx.fillText(b.label, b.x - 30, b.y + b.size/2 + 20);
    }

    // Головний цикл гри
    gameLoop() {
        this.draw();
        requestAnimationFrame(() => this.gameLoop());
    }
}
